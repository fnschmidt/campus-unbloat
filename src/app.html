<!doctype html>
<html lang="en" class="dark">
	<head>
		<meta charset="utf-8" />
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="%sveltekit.assets%/favicon-32x32.png?v=2"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="%sveltekit.assets%/favicon-16x16.png?v=2"
		/>
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="%sveltekit.assets%/apple-touch-icon.png?v=2"
		/>
		<link rel="manifest" href="%sveltekit.assets%/site.webmanifest?v=2" />
		<link rel="mask-icon" href="%sveltekit.assets%/safari-pinned-tab.svg?v=2" color="#905bd5" />
		<link rel="shortcut icon" href="%sveltekit.assets%/favicon.ico?v=2" />
		<meta name="msapplication-TileColor" content="#2d89ef" />
		<meta name="theme-color" content="" />

		<meta name="viewport" content="width=device-width" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="description" content="CampusDual 2025 Vision" />
		<title>CampusUnbloat</title>
		%sveltekit.head%
	</head>

	<body
		class="select-none touch-manipulation"
		style="-webkit-tap-highlight-color: transparent"
		data-sveltekit-preload-data="hover"
		data-theme="custom-crimson"
	>
		<div style="display: contents" class="h-full overflow-hidden">%sveltekit.body%</div>
	</body>

	<script>
		const observer = new MutationObserver((mutations) => {
			mutations.forEach((mutation) => {
				if (mutation.attributeName === 'class' && !nonObserverChange) {
					onDarkModeToggle(mutation.target);
				}
			});
		});

		// observe whenever root <html> adds/removes 'dark' class
		const htmlElement = document.documentElement;
		observer.observe(htmlElement, {
			attributes: true // Observe changes to attributes
		});

		let nonObserverChange = false;

		// Initial check on page load
		window.addEventListener('DOMContentLoaded', () => {
			onDarkModeToggle(htmlElement);
		});

		function switchEcDark(htmlElement) {
			nonObserverChange = true;

			if (!htmlElement.classList.contains('ec-dark')) {
				htmlElement.classList.add('ec-dark');
			} else {
				htmlElement.classList.remove('ec-dark');
			}
			nonObserverChange = false;
		}

		// set page theme based on user preference (media query doesnt work?)
		function onDarkModeToggle(mutationTarget) {
			const htmlElement = mutationTarget;
			const isDarkMode = htmlElement.classList.contains('dark');

			const themeColorMeta = document.querySelector('meta[name="theme-color"]');

			if (themeColorMeta) {
				themeColorMeta.setAttribute('content', isDarkMode ? 'rgb(27,27,27)' : 'rgb(213,213,217)');
			}

			// Check if the mode is in desired state
			if (isDarkMode && !htmlElement.classList.contains('ec-dark')) {
				switchEcDark(htmlElement);
			} else if (!isDarkMode && htmlElement.classList.contains('ec-dark')) {
				switchEcDark(htmlElement);
			}
		}
	</script>
</html>
